cd app
docker build -t devops-demo-fastapi:blabbla .

 docker-compose up -d --build

kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.14.1/deploy/static/provider/cloud/deploy.yaml
kubectl get pods -n ingress-nginx
kubectl get svc -n ingress-nginx

kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/secret.yaml
kubectl apply -f k8s/postgres-pvc.yaml
kubectl apply -f k8s/postgres-deployment.yaml
kubectl apply -f k8s/postgres-service.yaml
kubectl apply -f k8s/app-deployment.yaml
kubectl apply -f k8s/app-service.yaml
kubectl apply -f k8s/ingress.yaml

docker build -t devops-demo-fastapi:latest ./app 
kubectl rollout restart deployment/fastapi -n devops-demo 
Start-Sleep -Seconds 5 
kubectl get pods -n devops-demo
kubectl get pods -n devops-demo -o name

kubectl port-forward -n devops-demo svc/fastapi-svc 8000:80

kubectl get deployments -n devops-demo
kubectl get pods -n devops-demo

kubectl get pvc -n devops-demo
kubectl get pods -n devops-demo
kubectl get svc -n devops-demo

kubectl rollout restart deployment postgres -n devops-demo
kubectl rollout restart deployment fastapi -n devops-demo



kubectl delete deployment fastapi -n devops-demo
kubectl delete deployment postgres -n devops-demo
kubectl delete ingress fastapi-ingress -n devops-demo


kubectl get pods -n devops-demo
kubectl get deployments -n devops-demo

kubectl delete svc fastapi-svc -n devops-demo
kubectl delete svc postgres -n devops-demo
kubectl delete namespace devops-demo
kubectl delete namespace ingress-nginx

kubectl exec -it -n devops-demo deployment/fastapi -- env | Select-String POSTGRES

