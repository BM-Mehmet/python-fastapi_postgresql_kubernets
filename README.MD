# ğŸš€ DevOps Demo: FastAPI, PostgreSQL ve Kubernetes

Bu depo, bir Python FastAPI uygulamasÄ±nÄ±n **PostgreSQL** veritabanÄ± ile entegre edilerek **Kubernetes (K8s)** Ã¼zerinde daÄŸÄ±tÄ±mÄ±nÄ± (deployment) gÃ¶stermektedir. Proje, bir `db-count` (veritabanÄ± sayacÄ±) ve basit bir `hello` API iÅŸlevine sahiptir.

## ğŸŒŸ Proje Mimarisi

* **Uygulama:** Python FastAPI (Uygulama dosyalarÄ±: `./app` klasÃ¶rÃ¼)
    * API Endpointleri: `/hello` (Hello World) ve `/db-count` (VeritabanÄ±nda gelen istek sayÄ±sÄ±nÄ± dÃ¶ndÃ¼rÃ¼r)
* **VeritabanÄ±:** PostgreSQL
* **KonteynerleÅŸtirme:** Docker
* **Orkestrasyon:** Kubernetes (DaÄŸÄ±tÄ±m, Servis, PVC, Secret vb. K8s manifestolarÄ±: `./k8s` klasÃ¶rÃ¼)
* **GiriÅŸ KontrolÃ¼:** Nginx Ingress Controller

## ğŸ› ï¸ Ã–nkoÅŸullar

Bu projeyi yerel ortamÄ±nÄ±zda Ã§alÄ±ÅŸtÄ±rmak iÃ§in aÅŸaÄŸÄ±daki araÃ§lara ihtiyacÄ±nÄ±z vardÄ±r:

* **Docker**
* **kubectl** (Kubernetes komut satÄ±rÄ± aracÄ±)
* **Bir Kubernetes OrtamÄ±** (Yerel Docker Desktop K8s)

---

## âš™ï¸ Kurulum ve Ã‡alÄ±ÅŸtÄ±rma AdÄ±mlarÄ±

AÅŸaÄŸÄ±daki adÄ±mlar, FastAPI uygulamasÄ±nÄ± Docker imajÄ± olarak oluÅŸturmayÄ±, Kubernetes ortamÄ±nÄ± yapÄ±landÄ±rmayÄ± ve uygulamayÄ± daÄŸÄ±tmayÄ± iÃ§erir.

### 1. Docker Ä°majÄ±nÄ± OluÅŸturma

UygulamanÄ±n Docker imajÄ±nÄ± oluÅŸturun.

```bash
cd app
docker build -t devops-demo-fastapi:latest ./app
```
### 2. Nginx Ingress Controller Kurulumu

Uygulamaya dÄ±ÅŸarÄ±dan eriÅŸimi saÄŸlamak iÃ§in Nginx Ingress Controller'Ä± Kubernetes kÃ¼menize kurun.

Ingress Controller'Ä± kurma
```bash
kubectl apply -f [https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.14.1/deploy/static/provider/cloud/deploy.yaml](https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.14.1/deploy/static/provider/cloud/deploy.yaml)
```
Kurulum durumunu kontrol etme
```bash
kubectl get pods -n ingress-nginx
kubectl get svc -n ingress-nginx
```
### 3. Kubernetes KaynaklarÄ±nÄ± DaÄŸÄ±tma

UygulamanÄ±n Ã§alÄ±ÅŸmasÄ± iÃ§in gerekli olan Namespace, Secret, PostgreSQL ve FastAPI kaynaklarÄ±nÄ± sÄ±rayla uygulayÄ±n.
Namespace, Secret ve PVC oluÅŸturma
```bash
cd ..
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/secret.yaml
kubectl apply -f k8s/postgres-pvc.yaml
```
PostgreSQL VeritabanÄ±nÄ± daÄŸÄ±tma
```bash
kubectl apply -f k8s/postgres-deployment.yaml
kubectl apply -f k8s/postgres-service.yaml
```
FastAPI UygulamasÄ±nÄ± daÄŸÄ±tma
```bash
kubectl apply -f k8s/app-deployment.yaml
kubectl apply -f k8s/app-service.yaml
kubectl apply -f k8s/ingress.yaml
```
### 4. Pod'larÄ±n durumunu kontrol etme
```bash
kubectl get pods -n devops-demo
```
### 5. Uygulamaya Yerel EriÅŸim (Port Forwarding)

Uygulama servisine doÄŸrudan eriÅŸmek ve test etmek iÃ§in port yÃ¶nlendirme (Port Forwarding) kullanÄ±n.
```bash
kubectl port-forward -n devops-demo svc/fastapi-svc 8000:80

# Hello 
curl http://localhost:8000/hello

# db-count 
curl http://localhost:8000/db-count

```
### 6. Her ÅŸeyi silmek iÃ§in aÅŸaÄŸÄ±daki komutlarÄ± kullanÄ±n.
```bash
kubectl delete deployment fastapi -n devops-demo
kubectl delete deployment postgres -n devops-demo
kubectl delete ingress fastapi-ingress -n devops-demo
kubectl delete pvc pg-pvc -n devops-demo
kubectl delete svc fastapi-svc -n devops-demo
kubectl delete svc postgres -n devops-demo
kubectl delete namespace devops-demo
kubectl delete namespace ingress-nginx
```
